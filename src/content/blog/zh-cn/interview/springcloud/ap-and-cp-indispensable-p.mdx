---
author: chou403
publishDate: 2024-06-14T08:57:22
updatedDate: 2024-08-09T14:46:17
title: ap 和 cp 为什么 p 是不可或缺的
draft: false
heroImage: /src/assets/images/eightkun.jpg
category: Interview
tags:
  - java
description: ap 和 cp 为什么 p 是不可或缺的
---

## ap 和 cp 为什么 p 是不可或缺的

在分布式系统中,AP 和 CP 是指系统在面临网络分区(Partition)时,如何权衡一致性(Consistency)和可用性(Availability)的不同设计选择。这些概念源自于 CAP 定理(也称为布鲁尔定理),该定理指出在分布式数据存储系统中,不可能同时完全满足一致性,可用性和分区容忍性这三个需求:

### CAP 定理的定义

- **Consistency(一致性)**: 每次读取操作要么返回最新的写入结果,要么返回一个错误。
- **Availability(可用性)**: 每次请求都会收到一个(非错误)响应——但不保证它是最新的写入结果。
- **Partition tolerance(分区容忍性)**: 系统即使遇到任意数量的网络分区故障,仍能够继续运行。

"AP" 和 "CP" 是两种不同的一致性和可用性保证策略的代表。它们分别代表了分布式系统在出现网络分区(Partition)时,对一致性(Consistency)和可用性(Availability)的不同权衡。

1. **AP(可用性和分区容错性)**: AP 策略优先保证系统的可用性和分区容错性。即使发生了网络分区,系统仍然可以继续提供服务,尽管在分区后可能出现数据的不一致性。AP 系统通常允许部分节点或者服务在网络分区后继续提供服务,而不是停止整个系统的运行。这种策略适用于对系统的可用性要求比一致性要求更高的场景,例如互联网应用中的实时通信和在线游戏等。

2. **CP(一致性和分区容错性)**: CP 策略优先保证系统的一致性,即使在发生网络分区时也会暂时停止服务以确保数据的一致性。CP 系统会在发生网络分区时暂停部分或者全部服务,直到网络分区被解决并且数据恢复一致性。这种策略适用于对系统的一致性要求比可用性要求更高的场景,例如金融系统中的交易处理和数据存储等。

CAP 定理指出,在一个分布式系统中,当网络分区发生时,必须在一致性和可用性之间进行权衡。也就是说,你不能同时满足一致性和可用性,只能选择其中之一。

### 为什么 P(分区容忍性)是不可或缺的

分区容忍性在分布式系统中是不可或缺的原因如下:

1. **分布式系统的固有特性**:
   - 分布式系统由多个节点组成,这些节点通过网络相互通信。网络故障(如断开连接,延迟等)是不可避免的。在这种情况下,网络分区是分布式系统必须处理的一个基本问题。
   - 由于网络分区是现实中的一种常见情况,如果系统不具备分区容忍性,那么在发生网络分区时,系统将无法正常运行,这使得系统在实际应用中不具备可行性。
2. **CAP 定理的限制**:
   - CAP 定理强调,在网络分区不可避免的情况下,系统只能在一致性和可用性之间做出选择。因此,分区容忍性是前提条件,不是可以选择放弃的特性。
   - 也就是说,一个实际的分布式系统必须在分区容忍性和一致性,可用性之间进行权衡,但不能放弃分区容忍性。
3. **实际需求**:
   - 在实际应用中,用户期望系统能够在部分网络失败的情况下继续提供服务。放弃分区容忍性意味着系统在发生网络分区时将完全不可用,这对大多数应用场景来说是不可接受的。

在实践中,大多数分布式系统通常会牺牲一致性来保证可用性和分区容错性,或者牺牲部分可用性来提高一致性。例如,许多现代微服务架构倾向于采用最终一致性模型,允许短暂的数据不一致,以换取更高的可用性。
因此,对于分布式系统的设计者来说,理解CAP理论并根据系统需求来权衡这三者是非常重要的。在设计时,需要根据业务需求来决定是更偏向于CP(强一致性)还是AP(高可用性)。
