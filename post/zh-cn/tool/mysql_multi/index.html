<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><!-- <link rel="icon" type="image/svg+xml" href="/favicon1.svg" /> --><meta name="generator" content="Astro v4.16.2"><!-- Canonical URL --><link rel="canonical" href="https://blog-template-gray.vercel.app/post/zh-cn/tool/mysql_multi/"><!-- Primary Meta Tags --><title>mysqld_multi • 知道的越多,才知知道的越少</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- SEO --><meta name="title" content="mysqld_multi • 知道的越多,才知知道的越少"><meta name="description" content="基于 MySQL 自带工具 mysqld_multi 实现主从复制"><meta name="author" content="chou403"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://blog-template-gray.vercel.app/post/zh-cn/tool/mysql_multi/"><meta property="og:title" content="mysqld_multi"><meta property="og:description" content="基于 MySQL 自带工具 mysqld_multi 实现主从复制"><meta property="og:image" content="https://blog-template-gray.vercel.app/_astro/pexels-lucasandrade-4790498.jpg"><meta property="article:author" content="chou403"><meta property="article:published_time" content="2024-08-09T14:54:22.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog-template-gray.vercel.app/post/zh-cn/tool/mysql_multi/"><meta property="twitter:title" content="mysqld_multi"><meta property="twitter:description" content="基于 MySQL 自带工具 mysqld_multi 实现主从复制"><meta property="twitter:image" content="https://blog-template-gray.vercel.app/_astro/pexels-lucasandrade-4790498.jpg"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="知道的越多,才知知道的越少" href="/rss.xml"><link as="font" crossorigin rel="preload" href="/fonts/Manrope-Bold.woff2" type="font/woff2"><style>@font-face {font-weight: 200;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraLight.woff2)} @font-face {font-weight: 300;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Light.woff2)} @font-face {font-weight: 400;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Regular.woff2)} @font-face {font-weight: 500;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Medium.woff2)} @font-face {font-weight: 600;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-SemiBold.woff2)} @font-face {font-weight: 700;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Bold.woff2)} @font-face {font-weight: 800;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraBold.woff2)} @font-face { font-family: '_font_fallback_577731247688'; size-adjust: 103.76%; src: local('Arial'); ascent-override: 102.74%; descent-override: 28.91%; line-gap-override: 0.00%; }</style><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_page_.CCiJ3j76.css">
<link rel="stylesheet" href="/_astro/_slug_.Ba2ksmBT.css"><script type="module" src="/_astro/hoisted.D9DAUC0s.js"></script></head> <body class="mx-auto bg-white dark:bg-slate-900 dark:text-slate-400 dark:text-white" data-astro-cid-37fxchfa> <main class="mt-4 grid gap-12 overflow-hidden px-5 antialiased sm:mx-auto sm:max-w-2xl sm:px-8 md:max-w-6xl md:overflow-visible lg:px-0" data-astro-cid-37fxchfa> <header class="fixed left-0 top-0 z-50 flex h-12 w-full items-center bg-[#f8f9fa99] px-5 py-2.5 font-semibold dark:border-slate-50/[0.06] dark:bg-slate-900/60"> <a class="mr-auto text-lg" href="/">Home</a> <div id="astro-header-drawer" class="absolute right-1 top-12 z-50 translate-x-96 rounded-l-lg bg-white p-4 text-slate-500 shadow transition-transform duration-300 ease-in dark:bg-[#0a0910] md:static md:h-auto md:translate-x-0 md:rounded-none md:border-none md:bg-transparent md:p-0 md:shadow-none dark:md:bg-transparent"> <nav class="flex h-full justify-between gap-2 text-left md:w-full md:flex-row md:gap-5"> <div class="flex flex-col gap-4 border-black pr-4 dark:border-white md:flex-row md:border-r-2"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex items-center justify-center gap-3 md:justify-end md:p-0"> <a href="https://github.com/chou403/chou403.github.io" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg viewBox="0 0 16 16" class="h-5 w-5" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg> </span>  </a> </div> <!-- <LanguageSwitcher client:load /> --> </nav> </div> <div class="flex items-center gap-3 text-slate-500 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m19 19-3.5-3.5"></path><circle cx="11" cy="11" r="6"></circle></svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group" aria-label="Toggle Theme"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg viewBox="0 0 24 24" fill="none" class="h-6 w-6"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.715 15.15A6.5 6.5 0 0 1 9 6.035C6.106 6.922 4 9.645 4 12.867c0 3.94 3.153 7.136 7.042 7.136 3.101 0 5.734-2.032 6.673-4.853Z" class="fill-sky-400/20"></path><path d="m17.715 15.15.95.316a1 1 0 0 0-1.445-1.185l.495.869ZM9 6.035l.846.534a1 1 0 0 0-1.14-1.49L9 6.035Zm8.221 8.246a5.47 5.47 0 0 1-2.72.718v2a7.47 7.47 0 0 0 3.71-.98l-.99-1.738Zm-2.72.718A5.5 5.5 0 0 1 9 9.5H7a7.5 7.5 0 0 0 7.5 7.5v-2ZM9 9.5c0-1.079.31-2.082.845-2.93L8.153 5.5A7.47 7.47 0 0 0 7 9.5h2Zm-4 3.368C5 10.089 6.815 7.75 9.292 6.99L8.706 5.08C5.397 6.094 3 9.201 3 12.867h2Zm6.042 6.136C7.718 19.003 5 16.268 5 12.867H3c0 4.48 3.588 8.136 8.042 8.136v-2Zm5.725-4.17c-.81 2.433-3.074 4.17-5.725 4.17v2c3.552 0 6.553-2.327 7.622-5.537l-1.897-.632Z" class="fill-sky-500"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17 3a1 1 0 0 1 1 1 2 2 0 0 0 2 2 1 1 0 1 1 0 2 2 2 0 0 0-2 2 1 1 0 1 1-2 0 2 2 0 0 0-2-2 1 1 0 1 1 0-2 2 2 0 0 0 2-2 1 1 0 0 1 1-1Z" class="fill-sky-500"></path></svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" class="fill-sky-400/20 stroke-sky-500"></path><path d="M12 4v1M17.66 6.344l-.828.828M20.005 12.004h-1M17.66 17.664l-.828-.828M12 20.01V19M6.34 17.664l.835-.836M3.995 12.004h1.01M6 6l.835.836" class="stroke-sky-500"></path></svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="toggleMenu" class="md:ml-6 md:hidden"> <svg width="24" height="24"><path d="M5 6h14M5 12h14M5 18h14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg> </button> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg width="24" height="24" fill="none" aria-hidden="true"><path d="M12 6v.01M12 12v.01M12 18v.01M12 7a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm0 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm0 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg> <span class="sr-only">Show Menu</span> </button> </div> </header>  <div class="pointer-events-none absolute inset-x-0 top-0 z-[60] flex justify-center overflow-hidden"> <div class="flex w-[108rem] flex-none justify-end"> <picture> <source srcset="/_astro/docs.BiePeNN8.avif" type="image/avif"> <img src="/_astro/docs.BeNwu2rW_1CTG48.webp" class="w-[71.75rem] max-w-none flex-none dark:hidden" alt="img of docs" width="200" height="200" loading="lazy" decoding="async"> </picture> <picture> <source srcset="/_astro/docs-dark.C7CksN2y.avif" type="image/avif"> <img src="/_astro/docs-dark.Bsq-hjJH_17S3ea.webp" class="hidden w-[90rem] max-w-none flex-none dark:block" alt="img of docs-dark" width="200" height="200" loading="lazy" decoding="async"> </picture> </div> </div>  <article class="mt-12 min-w-full sm:max-w-none md:max-w-none md:py-4"> <header class="mb-3 flex flex-col gap-6"> <div class="flex flex-wrap gap-2"> <div class="flex items-center justify-center"> <h1 class="text-4xl font-semibold md:pb-2.5 md:text-4xl"> 基于 MySQL 自带工具 mysqld_multi 实现主从复制 </h1> </div> </div> <div class="flex gap-x-1"> <p class="text-center text-sm font-bold text-opacity-50"> chou403 </p> <p class="text-center text-sm font-bold text-opacity-50">
/ Tool </p> <p class="text-center text-sm text-opacity-50">
/ <time class="text-sm font-bold text-opacity-60" datetime="2024-01-27T15:56:54.000Z"> Jan 27, 2024 </time> </p> <p class="text-center text-sm font-bold text-opacity-50">
/ 14 min read </p> <!-- {
					data.updatedDate && (
						<span class="text-quote rounded-lg p-1">
							Last Updated:
							<FormattedDate date={data.updatedDate} />
						</span>
					)
				} --> </div> </header> <!-- annotate blog post image --> <!-- <>
			{
				heroImage && (
					<Image
						src={heroImage}
						width={1000}
						height={500}
						quality={100}
						format="jpg"
						loading="eager"
						class="my-8 max-h-[300px] w-full rounded-md object-cover md:max-h-[500px]"
						alt={`img of ${title}`}
					/>
				)
			}
		</> --> <hr> <div>   <div class="mt-8 grid grid-cols-1 gap-10"> <!-- aside  --> <!-- Left menu bar comments --> <!-- <aside class="hidden flex-col gap-8 md:flex">
			<div class="sticky top-12 z-10 hidden self-start transition-all duration-200 md:block">
				{headings && headings.length > 0 && <TableOfContents {headings} />}
			</div>
		</aside> --> <!-- post --> <article class="grid w-full max-w-full"> <div class="prose prose-lg mb-12 min-w-full dark:prose-invert md:prose-xl"> <h2 id="写在前面">写在前面</h2>
<p>正常情况是准备需要主从个数的服务器,每个服务器都安装好 mysql,主库数据内容同步到从库中。</p>
<p>本次记录是在一台机器通过 <code>mysqld_multi</code> 操作一主两从数据库服务。若多台服务,则将配置文件拆分配置即可。</p>
<p>本次安装使用了 HomeBrew,若用其他方式,或者路径不一致,<code>/opt/homebrew/opt/mysql</code> 更改成自己的安装路径即可。</p>
<h2 id="配置文件">配置文件</h2>
<p>安装 mysql</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">brew</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> mysql</span></span>
<span class="line"></span></code></pre> </div> 
<p>进入 mysql 安装之后的默认启动目录</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql</span></span>
<span class="line"></span></code></pre> </div> 
<p>创建数据目录 data,data 内创建三个文件夹,分别命名为 3306,3307和3308。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#9ECBFF"> data</span></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> data</span></span>
<span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#9ECBFF"> {3306,3307,3308}</span></span>
<span class="line"></span></code></pre> </div> 
<p>3306,3307和3308 文件夹就是分别放置我们每个实例(mysql 服务器)中的所有数据库,数据表和一些日志文件的地方,每个文件夹可以看到一个 mysql 服务器。</p>
<p>在 mysql 包中新建一个文件,将文件命名为 my.cnf,从此以后,这个文件就是我们需要一直使用的配置文件。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">touch</span><span style="color:#9ECBFF"> my.cnf</span></span>
<span class="line"></span></code></pre> </div> 
<p>打开 my.cnf 配置文件,将下列代码复制进入文件中:</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#E1E4E8">[mysqld]</span></span>
<span class="line"><span style="color:#6A737D"># mysql 安装目录</span></span>
<span class="line"><span style="color:#E1E4E8">basedir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld_multi]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqld_safe</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/mysql_multi.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3306]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#6A737D"># 数据库目录</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data</span></span>
<span class="line"><span style="color:#6A737D"># 端口</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3306</span></span>
<span class="line"><span style="color:#6A737D"># socket 登录 mysqld_multi 启动自动生成 退出 自动删除</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3306.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3307]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3307/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3307</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3307.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3308]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3308/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3308</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3308.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3</span></span>
<span class="line"></span>
<span class="line"></span></code></pre> </div> 
<h2 id="安装实例">安装实例</h2>
<h3 id="安装实例-3306">安装实例 3306</h3>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld</span><span style="color:#79B8FF"> --defaults-file=/opt/homebrew/etc/my.cnf</span><span style="color:#79B8FF"> --initialize</span><span style="color:#79B8FF"> --basedir=/opt/homebrew/opt/mysql/</span><span style="color:#79B8FF"> --datadir=/opt/homebrew/opt/mysql/data/3306/data</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:17.883145Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015017] [Server] MySQL Server Initialization - start.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:17.889196Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013169] [Server] /opt/homebrew/Cellar/mysql/8.2.0_1/bin/mysqld (</span><span style="color:#B392F0">mysqld</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">) initializing of server in progress as process 60393</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:17.895958Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [Warning] [MY-010159] [Server] Setting lower_case_table_names</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span><span style="color:#B392F0"> because</span><span style="color:#9ECBFF"> file</span><span style="color:#9ECBFF"> system</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/data/3306/data</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> case</span><span style="color:#9ECBFF"> insensitive</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:17.910343Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:18.038467Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:18.632405Z</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> root@localhost: j.10weTJs)iu</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:18.940457Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013172] [Server] Received SHUTDOWN from user </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">via user signal</span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8">. Shutting down mysqld (</span><span style="color:#B392F0">Version:</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:45:19.447294Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015018] [Server] MySQL Server Initialization - end.</span></span>
<span class="line"></span></code></pre> </div> 
<p>记住 root 账户初始密码:j.10weTJs)iu</p>
<h3 id="安装实例-3307">安装实例 3307</h3>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld</span><span style="color:#79B8FF"> --defaults-file=/opt/homebrew/etc/my.cnf</span><span style="color:#79B8FF"> --initialize</span><span style="color:#79B8FF"> --basedir=/opt/homebrew/opt/mysql/</span><span style="color:#79B8FF"> --datadir=/opt/homebrew/opt/mysql/data/3307/data</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:02.653813Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015017] [Server] MySQL Server Initialization - start.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:02.661065Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013169] [Server] /opt/homebrew/Cellar/mysql/8.2.0_1/bin/mysqld (</span><span style="color:#B392F0">mysqld</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">) initializing of server in progress as process 62369</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:02.667029Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [Warning] [MY-010159] [Server] Setting lower_case_table_names</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span><span style="color:#B392F0"> because</span><span style="color:#9ECBFF"> file</span><span style="color:#9ECBFF"> system</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/data/3307/data</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> case</span><span style="color:#9ECBFF"> insensitive</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:02.679468Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:02.771801Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:03.385917Z</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> root@localhost: a#=MYe)L:8aj</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:03.685023Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013172] [Server] Received SHUTDOWN from user </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">via user signal</span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8">. Shutting down mysqld (</span><span style="color:#B392F0">Version:</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:04.225769Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015018] [Server] MySQL Server Initialization - end.</span></span>
<span class="line"></span></code></pre> </div> 
<p>记住 root 账户初始密码:a#=MYe)L:8aj</p>
<h3 id="安装实例-3308">安装实例 3308</h3>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld</span><span style="color:#79B8FF"> --defaults-file=/opt/homebrew/etc/my.cnf</span><span style="color:#79B8FF"> --initialize</span><span style="color:#79B8FF"> --basedir=/opt/homebrew/opt/mysql/</span><span style="color:#79B8FF"> --datadir=/opt/homebrew/opt/mysql/data/3308/data</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.066014Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015017] [Server] MySQL Server Initialization - start.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.067626Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013169] [Server] /opt/homebrew/Cellar/mysql/8.2.0_1/bin/mysqld (</span><span style="color:#B392F0">mysqld</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">) initializing of server in progress as process 62774</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.069105Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [Warning] [MY-010159] [Server] Setting lower_case_table_names</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span><span style="color:#B392F0"> because</span><span style="color:#9ECBFF"> file</span><span style="color:#9ECBFF"> system</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/data/3308/data</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> case</span><span style="color:#9ECBFF"> insensitive</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.071151Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.171156Z</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.598694Z</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> root@localhost: HJgqw</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">Bi6Efb</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:12.866118Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-013172] [Server] Received SHUTDOWN from user </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">via user signal</span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8">. Shutting down mysqld (</span><span style="color:#B392F0">Version:</span><span style="color:#79B8FF"> 8.2.0</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">2024-01-25T04:46:13.501326Z</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> [System] [MY-015018] [Server] MySQL Server Initialization - end.</span></span>
<span class="line"></span></code></pre> </div> 
<p>记住 root 账户初始密码:HJgqw!Bi6Efb</p>
<h2 id="查看多实例">查看多实例</h2>
<p>使用mysqld_multi命令查看这些MySQL服务是否开启。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld_multi</span><span style="color:#79B8FF"> --defaults-extra-file=/opt/homebrew/opt/mysql/my.cnf</span><span style="color:#9ECBFF"> report</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Wide</span><span style="color:#9ECBFF"> character</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> print</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> /opt/homebrew/bin/mysqld_multi</span><span style="color:#9ECBFF"> line</span><span style="color:#9ECBFF"> 684.</span></span>
<span class="line"><span style="color:#B392F0">Reporting</span><span style="color:#9ECBFF"> MySQL</span><span style="color:#9ECBFF"> servers</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3306</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> not</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3307</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> not</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3308</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> not</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"></span></code></pre> </div> 
<h2 id="开启多实例">开启多实例</h2>
<p>使用mysqld_multi命令开启实例。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld_multi</span><span style="color:#79B8FF"> --defaults-extra-file=/opt/homebrew/opt/mysql/my.cnf</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> 3306,3307,3308</span></span>
<span class="line"></span></code></pre> </div> 
<p>再次查看多实例。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> mysqld_multi</span><span style="color:#79B8FF"> --defaults-extra-file=/opt/homebrew/opt/mysql/my.cnf</span><span style="color:#9ECBFF"> report</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Wide</span><span style="color:#9ECBFF"> character</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> print</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> /opt/homebrew/bin/mysqld_multi</span><span style="color:#9ECBFF"> line</span><span style="color:#9ECBFF"> 684.</span></span>
<span class="line"><span style="color:#B392F0">Reporting</span><span style="color:#9ECBFF"> MySQL</span><span style="color:#9ECBFF"> servers</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3306</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3307</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"><span style="color:#B392F0">MySQL</span><span style="color:#9ECBFF"> server</span><span style="color:#9ECBFF"> from</span><span style="color:#9ECBFF"> group:</span><span style="color:#9ECBFF"> mysqld3308</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> running</span></span>
<span class="line"></span></code></pre> </div> 
<p>查看 mysql 任务线程。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> ps</span><span style="color:#9ECBFF"> aux</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> mysqld</span></span>
<span class="line"></span></code></pre> </div> 
<h2 id="socket方式登录">socket方式登录</h2>
<p>使用 socket 的方式登录,必须使用 -S 参数,并且在后面加上.sock 文件的位置,需要注意的是,之后每一次登录,都需要使用这种 -S 方式进行登录。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#79B8FF"> -u</span><span style="color:#9ECBFF"> root</span><span style="color:#79B8FF"> -p</span><span style="color:#79B8FF"> -S</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/mysql_3306.sock</span></span>
<span class="line"></span></code></pre> </div> 
<p>系统会提示输入密码,将上面记录的初始密码输入,进入 mysql 服务器。</p>
<h3 id="更改-root-的密码">更改 root 的密码</h3>
<p>为了方便,我们将 3306 端口的服务器密码设置为 3306。同样方式更改其他两个。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#6A737D"># 8.0 以下版本 密码模式 mysql_native_password</span></span>
<span class="line"><span style="color:#B392F0">ALTER</span><span style="color:#9ECBFF"> USER</span><span style="color:#9ECBFF"> &#39;root&#39;@&#39;localhost&#39;</span><span style="color:#9ECBFF"> IDENTIFIED</span><span style="color:#9ECBFF"> WITH</span><span style="color:#9ECBFF"> mysql_native_password</span><span style="color:#9ECBFF"> BY</span><span style="color:#9ECBFF"> &#39;3306&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D"># 8.0 以上版本 密码模式 caching_sha2_password</span></span>
<span class="line"><span style="color:#B392F0">ALTER</span><span style="color:#9ECBFF"> USER</span><span style="color:#9ECBFF"> &#39;root&#39;@&#39;localhost&#39;</span><span style="color:#9ECBFF"> IDENTIFIED</span><span style="color:#9ECBFF"> WITH</span><span style="color:#9ECBFF"> caching_sha2_password</span><span style="color:#9ECBFF"> BY</span><span style="color:#9ECBFF"> &#39;3306&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<h3 id="关闭-mysql-服务器">关闭 mysql 服务器</h3>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysqladmin</span><span style="color:#79B8FF"> -S</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/mysql_3306.sock</span><span style="color:#79B8FF"> -uroot</span><span style="color:#79B8FF"> -p</span><span style="color:#9ECBFF"> shutdown。</span></span>
<span class="line"></span></code></pre> </div> 
<h2 id="日志文件">日志文件</h2>
<h3 id="mysql启动日志在哪">MySQL启动日志在哪?</h3>
<p>启动动日志记录了MySQL启动时的状态,如果你启动失败可以查看该日志,可以使用最普通的文本编辑器打开,根据ERROR信息进行必要的调整。由于我们的配置文件my.cnf指定了生成路径,该日志在MySQL服务启动后自动生成在你的mysql包内,全称为mysqld_multi.log。</p>
<h3 id="二进制文件在哪">二进制文件在哪?</h3>
<p>二进制文件主要记录MySQL数据库的变化,包含了所有更新了数据或者潜在更新了数据(例如没有匹配任何一行的UPDATE)的语句;还包含了每个更新数据库的语句的执行时间信息,使用二进制日志的目的是最大可能的恢复数据库,因为二进制日志包含备份后进行的所有更新,而且二进制文件是主从复制的重要桥梁和关键所在。</p>
<p>我们的二进制文件就在我们最初创建的3306文件夹内,具体路径是mysql/data/3306/data,使用 mysqlbinlog查看二进制文件。</p>
<p>每次重启服务器,都会新生成一个二进制日志,后缀以.000001开始递增。</p>
<h3 id="其它日志文件在哪">其它日志文件在哪?</h3>
<p>在配置文件中加上一行代码,就可以开启错误日志,当 mysql 需要记录错误发生时,就会保存在我们设置的路径上的日志中。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">log_error</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> /opt/homebrew/opt/mysql/data/3306/data/my_error.log</span></span>
<span class="line"></span></code></pre> </div> 
<p>如果我们需要开启通用查询日志,可以在 mysql 中使用命令开启。</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">set</span><span style="color:#9ECBFF"> @@global.general_log</span><span style="color:#9ECBFF"> =</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">Query</span><span style="color:#9ECBFF"> OK,</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> rows</span><span style="color:#9ECBFF"> affected</span><span style="color:#E1E4E8"> (0.01 </span><span style="color:#9ECBFF">sec</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre> </div> 
<p>执行成功之后,就会在 mysql/data/3306/data目录下新增一个.log 的日志文件。</p>
<p>如果我们需要开启慢羊羊日志</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">set</span><span style="color:#9ECBFF"> @@global.slow_query_log</span><span style="color:#9ECBFF"> =</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">Query</span><span style="color:#9ECBFF"> OK,</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> rows</span><span style="color:#9ECBFF"> affected</span><span style="color:#E1E4E8"> (0.01 </span><span style="color:#9ECBFF">sec</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre> </div> 
<p>执行成功之后,就会在 mysql/data/3306/data目录下新增一个-slow.log 的日志文件。</p>
<h2 id="多实例解耦">多实例解耦</h2>
<p>在上文中,我们把若干个实例的配置信息放在同一个配置文件my.cnf中,如果若干个实例都是通过同一个配置文件启动,那么耦合性就太高了,试想一下,当我们同时开启了若干个实例,例如同时开启了3306,3307和3308MySQL服务,而在中途突然需要改变一下3306服务的配置,那么修改配置文件之后进行MySQL服务的重启,又因为服务重启是通过配置文件启动的,而其它实例的配置内容又在同一份文件中,那么有可能在对3306修改时造成对其它实例的影响。</p>
<p>基于上述问题,为了降低MySQL各个服务的耦合度,我们可以通过创建多个配置文件来生成多个实例,通俗一点说,一个单独的MySQL服务就有一个单独的配置文件,这样,每一个MySQL服务之间就被分割开了,单独的修改配置,不会对其它服务造成影响,以此降低耦合。</p>
<p>直接删除原先的 mysql ,新建安装,将 my.cnf 内容拆成三个配置文件 3306.cnf,3307.cnf 和 3308.cnf。</p>
<h3 id="多实例配置文件">多实例配置文件</h3>
<p>3306.cnf 配置文件添加以下内容:</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#E1E4E8">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8">basedir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld_multi]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqld_safe</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/mysql_multi.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3306]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3306</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3306.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">1</span></span>
<span class="line"></span></code></pre> </div> 
<p>3307.cnf 配置文件添加以下内容:</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#E1E4E8">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8">basedir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld_multi]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqld_safe</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/mysql_multi.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3307]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3307/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3307</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3307.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span></span>
<span class="line"></span></code></pre> </div> 
<p>3308.cnf 配置文件添加以下内容:</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#E1E4E8">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8">basedir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld_multi]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqld_safe</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/mysql_multi.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3308]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3308/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3308</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3308.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3</span></span>
<span class="line"></span></code></pre> </div> 
<p>后面的操作流程一致,只是把上文中的单个配置文件启动,调整为三个配置文件启动。</p>
<h2 id="主从复制">主从复制</h2>
<h3 id="主从复制配置文件">主从复制配置文件</h3>
<p>主库配置开启 binlog 参数</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">log_bin</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> mysql-bin</span></span>
<span class="line"></span></code></pre> </div> 
<p>完整的 my.cnf 配置文件内容如下:</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#E1E4E8">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8">basedir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld_multi]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqld_safe</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/bin/mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/mysql_multi.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3306]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3306</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3306.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">1</span></span>
<span class="line"><span style="color:#E1E4E8">log_error</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data/my_error.log</span></span>
<span class="line"><span style="color:#E1E4E8">character-set-server</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">UTF8MB4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">#设置二进制日志名称为mysql-bin</span></span>
<span class="line"><span style="color:#E1E4E8">log_bin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysql-bin</span></span>
<span class="line"><span style="color:#6A737D">#需要主从复制的数据库 ,如多个则重复配置</span></span>
<span class="line"><span style="color:#E1E4E8">binlog-do-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">boot</span></span>
<span class="line"><span style="color:#6A737D">#复制过滤:也就是指定哪个数据库不用同步(mysql库一般不同步) ,如多个则重复配置</span></span>
<span class="line"><span style="color:#E1E4E8">binlog-ignore-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysql</span></span>
<span class="line"><span style="color:#6A737D">#主从复制的格式(mixed,statement,row,默认格式是statement。建议是设置为row,主从复制时数据更加能够统一)</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_format</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">row</span></span>
<span class="line"><span style="color:#6A737D">#mysql8.0以上版本通过设置全局参数binlog_expire_logs_seconds修改binlog保存时间 以秒为单位;默认2592000 30天</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_expire_logs_seconds</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">604800</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3307]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3307/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3307</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3307.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2</span></span>
<span class="line"><span style="color:#E1E4E8">log_error</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data/my_error.log</span></span>
<span class="line"><span style="color:#E1E4E8">character-set-server</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">UTF8MB4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">#设置中继日志名称为slave-relay-bin</span></span>
<span class="line"><span style="color:#E1E4E8">relay_log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">slave-relay-bin</span></span>
<span class="line"><span style="color:#E1E4E8">replicate-do-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">boot</span></span>
<span class="line"><span style="color:#E1E4E8">binlog-ignore-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysql</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_format</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">row</span></span>
<span class="line"><span style="color:#E1E4E8">read_only</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">ON</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_expire_logs_seconds</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">604800</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[mysqld3308]</span></span>
<span class="line"><span style="color:#E1E4E8">mysqld</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqld</span></span>
<span class="line"><span style="color:#E1E4E8">mysqladmin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysqladmin</span></span>
<span class="line"><span style="color:#E1E4E8">datadir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3308/data</span></span>
<span class="line"><span style="color:#E1E4E8">port</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3308</span></span>
<span class="line"><span style="color:#E1E4E8">socket</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/mysql_3308.sock</span></span>
<span class="line"><span style="color:#E1E4E8">server_id</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3</span></span>
<span class="line"><span style="color:#E1E4E8">log_error</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/opt/homebrew/opt/mysql/data/3306/data/my_error.log</span></span>
<span class="line"><span style="color:#E1E4E8">character-set-server</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">UTF8MB4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">#设置中继日志名称为slave-relay-bin</span></span>
<span class="line"><span style="color:#E1E4E8">relay_log</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">slave-relay-bin</span></span>
<span class="line"><span style="color:#E1E4E8">replicate-do-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">boot</span></span>
<span class="line"><span style="color:#E1E4E8">binlog-ignore-db</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">mysql</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_format</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">row</span></span>
<span class="line"><span style="color:#E1E4E8">read_only</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">ON</span></span>
<span class="line"><span style="color:#E1E4E8">binlog_expire_logs_seconds</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">604800</span></span>
<span class="line"></span>
<span class="line"></span></code></pre> </div> 
<p>设置完成并保存后记得重启服务。</p>
<h3 id="同步账号">同步账号</h3>
<h4 id="主库操作">主库操作</h4>
<p>主库创建从库同步账号</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">CREATE</span><span style="color:#9ECBFF"> USER</span><span style="color:#9ECBFF"> &#39;replication&#39;@&#39;%&#39;</span><span style="color:#9ECBFF"> IDENTIFIED</span><span style="color:#9ECBFF"> BY</span><span style="color:#9ECBFF"> &#39;123456&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>赋予 REPLICATION 账号 salve 权限</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">GRANT</span><span style="color:#9ECBFF"> REPLICATION</span><span style="color:#9ECBFF"> SLAVE</span><span style="color:#9ECBFF"> ON</span><span style="color:#79B8FF"> *</span><span style="color:#9ECBFF">.</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF"> TO</span><span style="color:#9ECBFF"> &#39;replication&#39;@&#39;%&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>刷新</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">FLUSH</span><span style="color:#9ECBFF"> PRIVILEGES</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>查看主库状态</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">show</span><span style="color:#9ECBFF"> master</span><span style="color:#9ECBFF"> status</span><span style="color:#79B8FF">\G</span></span>
<span class="line"><span style="color:#F97583">***************************</span><span style="color:#E1E4E8"> 1. row </span><span style="color:#F97583">***************************</span></span>
<span class="line"><span style="color:#B392F0">             File:</span><span style="color:#9ECBFF"> mysql-bin.000008</span></span>
<span class="line"><span style="color:#B392F0">         Position:</span><span style="color:#79B8FF"> 575</span></span>
<span class="line"><span style="color:#B392F0">     Binlog_Do_DB:</span><span style="color:#9ECBFF"> boot</span></span>
<span class="line"><span style="color:#B392F0"> Binlog_Ignore_DB:</span><span style="color:#9ECBFF"> mysql</span></span>
<span class="line"><span style="color:#B392F0">Executed_Gtid_Set:</span></span>
<span class="line"><span style="color:#B392F0">1</span><span style="color:#9ECBFF"> row</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> set,</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> warning</span><span style="color:#E1E4E8"> (0.00 </span><span style="color:#9ECBFF">sec</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre> </div> 
<h4 id="从库操作">从库操作</h4>
<p>设定从主库同步</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">change</span><span style="color:#9ECBFF"> master</span><span style="color:#9ECBFF"> to</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_HOST</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;localhost&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_PORT</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">3306,</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_USER</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;replication&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_PASSWORD</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;123456&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_LOG_FILE</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;mysql-bin.000008&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8">    MASTER_LOG_POS</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">575,</span></span>
<span class="line"><span style="color:#E1E4E8">    GET_MASTER_PUBLIC_KEY</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>从库同步开关</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">stop</span><span style="color:#9ECBFF"> slave</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">start</span><span style="color:#9ECBFF"> slave</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>查看从库状态</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">show</span><span style="color:#9ECBFF"> slave</span><span style="color:#9ECBFF"> status</span><span style="color:#79B8FF">\G</span></span>
<span class="line"><span style="color:#F97583">***************************</span><span style="color:#E1E4E8"> 1. row </span><span style="color:#F97583">***************************</span></span>
<span class="line"><span style="color:#B392F0">               Slave_IO_State:</span><span style="color:#9ECBFF"> Waiting</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> source</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> send</span><span style="color:#9ECBFF"> event</span></span>
<span class="line"><span style="color:#B392F0">                  Master_Host:</span><span style="color:#9ECBFF"> localhost</span></span>
<span class="line"><span style="color:#B392F0">                  Master_User:</span><span style="color:#9ECBFF"> replication</span></span>
<span class="line"><span style="color:#B392F0">                  Master_Port:</span><span style="color:#79B8FF"> 3306</span></span>
<span class="line"><span style="color:#B392F0">                Connect_Retry:</span><span style="color:#79B8FF"> 60</span></span>
<span class="line"><span style="color:#B392F0">              Master_Log_File:</span><span style="color:#9ECBFF"> mysql-bin.000008</span></span>
<span class="line"><span style="color:#B392F0">          Read_Master_Log_Pos:</span><span style="color:#79B8FF"> 575</span></span>
<span class="line"><span style="color:#B392F0">               Relay_Log_File:</span><span style="color:#9ECBFF"> slave-relay-bin.000002</span></span>
<span class="line"><span style="color:#B392F0">                Relay_Log_Pos:</span><span style="color:#79B8FF"> 744</span></span>
<span class="line"><span style="color:#B392F0">        Relay_Master_Log_File:</span><span style="color:#9ECBFF"> mysql-bin.000008</span></span>
<span class="line"><span style="color:#B392F0">             Slave_IO_Running:</span><span style="color:#9ECBFF"> Yes</span></span>
<span class="line"><span style="color:#B392F0">            Slave_SQL_Running:</span><span style="color:#9ECBFF"> Yes</span></span>
<span class="line"><span style="color:#B392F0">              Replicate_Do_DB:</span><span style="color:#9ECBFF"> boot</span></span>
<span class="line"><span style="color:#B392F0">          Replicate_Ignore_DB:</span></span>
<span class="line"><span style="color:#B392F0">           Replicate_Do_Table:</span></span>
<span class="line"><span style="color:#B392F0">       Replicate_Ignore_Table:</span></span>
<span class="line"><span style="color:#B392F0">      Replicate_Wild_Do_Table:</span></span>
<span class="line"><span style="color:#B392F0">  Replicate_Wild_Ignore_Table:</span></span>
<span class="line"><span style="color:#B392F0">                   Last_Errno:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">                   Last_Error:</span></span>
<span class="line"><span style="color:#B392F0">                 Skip_Counter:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">          Exec_Master_Log_Pos:</span><span style="color:#79B8FF"> 575</span></span>
<span class="line"><span style="color:#B392F0">              Relay_Log_Space:</span><span style="color:#79B8FF"> 954</span></span>
<span class="line"><span style="color:#B392F0">              Until_Condition:</span><span style="color:#9ECBFF"> None</span></span>
<span class="line"><span style="color:#B392F0">               Until_Log_File:</span></span>
<span class="line"><span style="color:#B392F0">                Until_Log_Pos:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">           Master_SSL_Allowed:</span><span style="color:#9ECBFF"> No</span></span>
<span class="line"><span style="color:#B392F0">           Master_SSL_CA_File:</span></span>
<span class="line"><span style="color:#B392F0">           Master_SSL_CA_Path:</span></span>
<span class="line"><span style="color:#B392F0">              Master_SSL_Cert:</span></span>
<span class="line"><span style="color:#B392F0">            Master_SSL_Cipher:</span></span>
<span class="line"><span style="color:#B392F0">               Master_SSL_Key:</span></span>
<span class="line"><span style="color:#B392F0">        Seconds_Behind_Master:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">Master_SSL_Verify_Server_Cert:</span><span style="color:#9ECBFF"> No</span></span>
<span class="line"><span style="color:#B392F0">                Last_IO_Errno:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">                Last_IO_Error:</span></span>
<span class="line"><span style="color:#B392F0">               Last_SQL_Errno:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">               Last_SQL_Error:</span></span>
<span class="line"><span style="color:#B392F0">  Replicate_Ignore_Server_Ids:</span></span>
<span class="line"><span style="color:#B392F0">             Master_Server_Id:</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#B392F0">                  Master_UUID:</span><span style="color:#9ECBFF"> a781c79c-bb49-11ee-a395-516e37c8480e</span></span>
<span class="line"><span style="color:#B392F0">             Master_Info_File:</span><span style="color:#9ECBFF"> mysql.slave_master_info</span></span>
<span class="line"><span style="color:#B392F0">                    SQL_Delay:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">          SQL_Remaining_Delay:</span><span style="color:#9ECBFF"> NULL</span></span>
<span class="line"><span style="color:#B392F0">      Slave_SQL_Running_State:</span><span style="color:#9ECBFF"> Replica</span><span style="color:#9ECBFF"> has</span><span style="color:#9ECBFF"> read</span><span style="color:#9ECBFF"> all</span><span style="color:#9ECBFF"> relay</span><span style="color:#9ECBFF"> log</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">waiting</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> more</span><span style="color:#9ECBFF"> updates</span></span>
<span class="line"><span style="color:#B392F0">           Master_Retry_Count:</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"><span style="color:#B392F0">                  Master_Bind:</span></span>
<span class="line"><span style="color:#B392F0">      Last_IO_Error_Timestamp:</span></span>
<span class="line"><span style="color:#B392F0">     Last_SQL_Error_Timestamp:</span></span>
<span class="line"><span style="color:#B392F0">               Master_SSL_Crl:</span></span>
<span class="line"><span style="color:#B392F0">           Master_SSL_Crlpath:</span></span>
<span class="line"><span style="color:#B392F0">           Retrieved_Gtid_Set:</span></span>
<span class="line"><span style="color:#B392F0">            Executed_Gtid_Set:</span></span>
<span class="line"><span style="color:#B392F0">                Auto_Position:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">         Replicate_Rewrite_DB:</span></span>
<span class="line"><span style="color:#B392F0">                 Channel_Name:</span></span>
<span class="line"><span style="color:#B392F0">           Master_TLS_Version:</span></span>
<span class="line"><span style="color:#B392F0">       Master_public_key_path:</span></span>
<span class="line"><span style="color:#B392F0">        Get_master_public_key:</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#B392F0">            Network_Namespace:</span></span>
<span class="line"><span style="color:#B392F0">1</span><span style="color:#9ECBFF"> row</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> set,</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> warning</span><span style="color:#E1E4E8"> (0.00 </span><span style="color:#9ECBFF">sec</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre> </div> 
<h2 id="问题">问题</h2>
<p>记录配置过程中可能出现的问题
<strong>Replica failed to initialize applier metadata structure from the repository</strong></p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">stop</span><span style="color:#9ECBFF"> slave</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">reset</span><span style="color:#9ECBFF"> slave</span><span style="color:#9ECBFF"> all</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">mysql</span><span style="color:#E1E4E8">&gt; </span><span style="color:#9ECBFF">start</span><span style="color:#9ECBFF"> slave</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>之后再重新执行 change master to 。</p>
<p><strong>Error connecting to source ‘replication@localhost:3306’. This was attempt 1/10, with a delay of 60 seconds between attempts. Message: Authentication plugin ‘caching_sha2_password’ reported error: Authentication requires secure connection.</strong></p>
<p>mysql 8.0之后默认的认证方式变为<code>caching_sha2_password</code>;</p>
<p>解决方案</p>
<p>从库中执行,之后重新 start slave;</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B392F0">CHANGE</span><span style="color:#9ECBFF"> MASTER</span><span style="color:#9ECBFF"> TO</span><span style="color:#9ECBFF"> GET_MASTER_PUBLIC_KEY=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p><strong>Plugin mysql_native_password reported: ”mysql_native_password’ is deprecated and will be removed in a future release. Please use caching_sha2_password instead’</strong>
如果你的MySQL的用户还在使用mysql_native_password(密码插件)的认证方式,那么在MySQL更新到8.0.34后,每次数据库用户以mysql_native_password方式访问MySQL,日志就会输出mysql_native_password已经废弃,即将在未来版本移除,以caching_sha2_password替代。</p>
<p>通过以下 sql 查询用户密码模式</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#F97583">select</span><span style="color:#E1E4E8"> user,host,plugin from mysql.user;</span></span>
<span class="line"></span></code></pre> </div> 
<p>旧的数据库账号,除了 MySQL 自带的账户,通过 sql 来更新认证模式和密码 密码可以和旧密码一致</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#F97583">ALTER</span><span style="color:#F97583"> USER</span><span style="color:#9ECBFF"> &#39;用户名&#39;</span><span style="color:#E1E4E8">@</span><span style="color:#9ECBFF">&#39;域&#39;</span><span style="color:#E1E4E8"> IDENTIFIED </span><span style="color:#F97583">WITH</span><span style="color:#E1E4E8"> caching_sha2_password </span><span style="color:#F97583">BY</span><span style="color:#9ECBFF"> &#39;密码&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div> 
<p>MySQL 自身的账户,可以通过以下 sql 更新到 mysql_native_password 模式</p>
<!-- remove bg-neutral-200/30 --><div class="code-container"> <pre class="shiki shiki-themes code dark:shadow-2xl"><button aria-label="copy-button" class="copy-button rounded-md transition-all ease-in dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 z-[2]"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400"><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#F97583">update</span><span style="color:#79B8FF"> mysql</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">user</span><span style="color:#F97583"> set</span><span style="color:#E1E4E8"> plugin</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;caching_sha2_password&#39;</span><span style="color:#F97583"> where</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &#39;root&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span></code></pre> </div>  </div> <div class="mb-12 flex flex-wrap gap-2 gap-y-4 md:gap-5"> <a href="/tags/tool" aria-label="tool"> <!-- <span
		class="w-fit rounded-full bg-indigo-600 px-2 py-1 text-sm font-semibold text-white shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2"
	> --> <span class="w-fit rounded-full px-2 py-1 text-sm font-semibold shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2">
#tool </span> </a><a href="/tags/mysql" aria-label="mysql"> <!-- <span
		class="w-fit rounded-full bg-indigo-600 px-2 py-1 text-sm font-semibold text-white shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2"
	> --> <span class="w-fit rounded-full px-2 py-1 text-sm font-semibold shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2">
#mysql </span> </a><a href="/tags/mysqld_multi" aria-label="mysqld_multi"> <!-- <span
		class="w-fit rounded-full bg-indigo-600 px-2 py-1 text-sm font-semibold text-white shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2"
	> --> <span class="w-fit rounded-full px-2 py-1 text-sm font-semibold shadow dark:bg-indigo-900 dark:text-white md:px-5 md:py-2">
#mysqld_multi </span> </a> </div> <!-- related posts --> <footer> <h2 class="mb-6 text-lg font-bold dark:text-white">Related Posts</h2> <section class="flex flex-col md:flex-row sm:justify-between gap-8"> <div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/bird-7_Z1mdY0E.webp" class="h-16 w-16 rounded-full object-cover" alt="img of node copy static file" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex items-center justify-center"> <a class="font-medium hover:underline" href="/post/zh-cn/tool/node-copy-static-file/"> node 构建之后复制静态文件到 dist 目录 </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/cat-13_ZAabEW.webp" class="h-16 w-16 rounded-full object-cover" alt="img of MySQL 条件语句使用索引" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex items-center justify-center"> <a class="font-medium hover:underline" href="/post/zh-cn/interview/mysql/mysql-conditions-use-index/"> 以mysql 条件哪些会用到索引下 </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/pexels-cartier-1198802_Z1ai80I.webp" class="h-16 w-16 rounded-full object-cover" alt="img of MybatisPlus generator" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex items-center justify-center"> <a class="font-medium hover:underline" href="/post/zh-cn/tool/mybatis-plus-generator/"> MybatisPlus 代码生成工具配置(基于 IDEA plugin) </a> </header> </div> </section> </footer> </article> </div>  </div> </article> <button aria-label="Back to Top" class="z-90 fixed bottom-8 end-4 flex h-10 w-10 translate-y-28 items-center justify-center rounded-full border-2 border-transparent bg-[#f8f9fa99] text-3xl opacity-0 transition-all duration-300 hover:border-zinc-400 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 dark:border-slate-50/[0.06] dark:bg-slate-900/75 sm:end-8 sm:h-12 sm:w-12" data-show="false" id="to-top-btn" style="opacity: 1;--tw-translate-y: -26px;
		transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));"> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  <footer class="flex h-28 w-full items-center justify-center border-t-2 px-16">
&copy; 2024 chou403 · Powered by &nbsp;<a href="https://astro.build" style="color:cornflowerblue;">Astro</a>&nbsp;& &nbsp;<a href="https://blog-template-gray.vercel.app" style="color:cornflowerblue;">OpenBlog</a> </footer> </main>    </body> </html>  <div> <div class="fixed inset-0 z-50 hidden" id="headlessui-dialog-:Rlb6:" role="dialog" aria-modal="true" data-headlessui-state="open"> <div class="fixed inset-0 bg-black/20 backdrop-blur-sm dark:bg-slate-900/80" id="" aria-hidden="true" data-headlessui-state="open"></div> <div class="relative w-80 max-w-[calc(100%-3rem)] bg-white p-6 dark:bg-slate-800" id="toc_content"> <button id="close-dialog-page" type="button" class="absolute right-5 top-5 z-10 flex h-8 w-8 items-center justify-center text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300" tabindex="0"><span class="sr-only">Close navigation</span> <svg viewBox="0 0 10 10" class="h-2.5 w-2.5 overflow-visible"> <path d="M0 0L10 10M10 0L0 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path> </svg> </button> <nav class="h-[59rem] max-w-xs dark:text-black"> <h1 class="mb-3 text-2xl font-bold dark:text-white">On this page</h1> <ul class="sidebar flex flex-col gap-4 [text-wrap:balance]"> <li class="flex flex-col"> <a href="#写在前面" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 写在前面 </a>  </li><li class="flex flex-col"> <a href="#配置文件" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 配置文件 </a>  </li><li class="flex flex-col"> <a href="#安装实例" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 安装实例 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#安装实例-3306" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 安装实例 3306 </a>  </li><li class="flex flex-col"> <a href="#安装实例-3307" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 安装实例 3307 </a>  </li><li class="flex flex-col"> <a href="#安装实例-3308" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 安装实例 3308 </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#查看多实例" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 查看多实例 </a>  </li><li class="flex flex-col"> <a href="#开启多实例" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 开启多实例 </a>  </li><li class="flex flex-col"> <a href="#socket方式登录" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> socket方式登录 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#更改-root-的密码" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 更改 root 的密码 </a>  </li><li class="flex flex-col"> <a href="#关闭-mysql-服务器" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 关闭 mysql 服务器 </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#日志文件" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 日志文件 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#mysql启动日志在哪" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> MySQL启动日志在哪? </a>  </li><li class="flex flex-col"> <a href="#二进制文件在哪" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 二进制文件在哪? </a>  </li><li class="flex flex-col"> <a href="#其它日志文件在哪" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 其它日志文件在哪? </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#多实例解耦" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 多实例解耦 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#多实例配置文件" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 多实例配置文件 </a>  </li> </ul> </li><li class="flex flex-col"> <a href="#主从复制" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 主从复制 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#主从复制配置文件" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 主从复制配置文件 </a>  </li><li class="flex flex-col"> <a href="#同步账号" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 同步账号 </a> <ul class="ml-3"> <li class="flex flex-col"> <a href="#主库操作" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 主库操作 </a>  </li><li class="flex flex-col"> <a href="#从库操作" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 从库操作 </a>  </li> </ul> </li> </ul> </li><li class="flex flex-col"> <a href="#问题" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> 问题 </a>  </li> </ul> </nav> </div> </div> </div> 